<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Bubble Chart</title>
        <script src="https://d3js.org/d3.v3.min.js"></script>
        <link rel="stylesheet" type="text/css" href="./main.css">
    </head>
    <body>
        <svg width = "1000px" height="1000px"></svg>
        <script type="text/javascript">
        data = fetch("https://fio3.ntnu.best/alpaca/%3Cgoogl%3E%3Caapl%3E%3Ctsla%3E%3Cfb%3E%3Camzn%3E/AAA")
        .then(function(response) {
            data = response.json().then(function(data){

        var arrData = []
        

        for(var i=0; i< data.length; i++){
            console.log("Data",data[i])
            data[i]["name"] = data[i]["ID"];
            data[i]["value"] = data[i]["SDT"] * 1000;
            data[i]["group"] = "No";
            data[i]["title"] = data[i]["ID"];

            var out = Object()
            out["name"] = data[i]["name"];
            out["value"] = Math.abs(data[i]["value"]);
            out["group"] = "No";
            out["title"] = data[i]["ID"];

            arrData.push(out)
        }
        data["columns"] = ["id", "value"];
        arrData.columns = ["id", "value"];

        console.log(arrData);
        var dataobj = { children: arrData };

        console.log(d3);
        var pack = d3.layout.pack();
        pack = pack.padding(2).size([1000,600]);
        var nodes = pack.nodes(dataobj);
        nodes = nodes.filter(function(it) { return it.parent; });

        d3.select("svg")
        .selectAll("circle")                 // 建立 circle 的 Selection
        .data(nodes)                         // 綁定 selection 與資料
        .enter()                             // 對於任何沒被對應而落單的資料 ...
        .append("circle")                    // 新增一個 circle 標籤
        .attr({
            cx: function(it) { return it.x; }, // 用 x,y 當圓心
            cy: function(it) { return it.y; },
            r : function(it) { return it.r; }, // 用 r 當半徑
            fill: "#ccc",                      // 填滿亮灰色
            stroke: "#444",                    // 邊框畫深灰色
        })
        .text(function(d){
            console.log(d.name);
            return d.name;
        });
 })
})


        </script>
    </body>
</html>